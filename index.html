<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>选举投票系统 - 修复版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b',
                        accent: '#f97316',
                        dark: '#1e293b',
                        light: '#f8fafc'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
            }
            .progress-animation {
                transition: width 1s ease-in-out;
            }
            .voted {
                border: 2px solid #10b981;
            }
            .btn-active {
                cursor: pointer;
                pointer-events: auto;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-md fixed w-full top-0 z-50 transition-all duration-300" id="navbar">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-vote-yea text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-dark">选举投票系统</h1>
            </div>
            <nav class="hidden md:flex space-x-6">
                <a href="#" class="text-primary font-medium hover:text-primary/80 transition-colors">首页</a>
                <a href="#candidates" class="text-gray-600 font-medium hover:text-primary transition-colors">候选人</a>
                <a href="#results" class="text-gray-600 font-medium hover:text-primary transition-colors">实时结果</a>
                <a href="#" class="text-gray-600 font-medium hover:text-primary transition-colors">关于选举</a>
            </nav>
            <div class="flex items-center">
                <span id="voterStatus" class="mr-4 text-sm text-gray-600">
                    <i class="fa fa-user-circle-o"></i> 未投票
                </span>
                <button class="md:hidden text-gray-600 focus:outline-none" id="menuToggle">
                    <i class="fa fa-bars text-xl"></i>
                </button>
            </div>
        </div>
        <!-- 移动端菜单 -->
        <div class="md:hidden hidden bg-white border-t" id="mobileMenu">
            <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
                <a href="#" class="text-primary font-medium py-2 hover:text-primary/80 transition-colors">首页</a>
                <a href="#candidates" class="text-gray-600 font-medium py-2 hover:text-primary transition-colors">候选人</a>
                <a href="#results" class="text-gray-600 font-medium py-2 hover:text-primary transition-colors">实时结果</a>
                <a href="#" class="text-gray-600 font-medium py-2 hover:text-primary transition-colors">关于选举</a>
            </div>
        </div>
    </header>

    <!-- 主要内容 -->
    <main class="container mx-auto px-4 pt-24 pb-16">
        <!-- 英雄区域 -->
        <section class="mb-16 text-center">
            <div class="inline-block mb-4 px-4 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">
                <i class="fa fa-clock-o mr-1"></i> 投票进行中
            </div>
            <h2 class="text-[clamp(2rem,5vw,3.5rem)] font-bold text-dark mb-6 leading-tight text-shadow">
                行使您的投票权
            </h2>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto mb-6">
                请从以下候选人中选择您支持的一位进行投票，您的每一票都至关重要
            </p>
            <div id="votingStatus" class="text-sm text-gray-500 mb-10">
                总投票数: <span id="totalVotes" class="font-semibold text-primary">0</span> | 剩余投票时间: <span class="font-semibold text-primary" id="countdown">7天12小时30分钟</span>
            </div>
        </section>

        <!-- 候选人投票区域 -->
        <section id="candidates" class="mb-20">
            <div class="text-center mb-12">
                <h3 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-dark mb-4">候选人列表</h3>
                <p class="text-gray-600 max-w-2xl mx-auto">点击下方候选人卡片进行投票，每人限投一票</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- 候选人1 -->
                <div class="candidate-card bg-white rounded-xl shadow-lg overflow-hidden card-hover cursor-pointer" data-id="1">
                    <div class="h-48 bg-gradient-to-r from-blue-500 to-indigo-600 relative">
                        <div class="absolute -bottom-16 left-1/2 transform -translate-x-1/2 w-32 h-32 rounded-full border-4 border-white overflow-hidden">
                            <img src="https://picsum.photos/id/1012/200/200" alt="超屑的德华球的照片" class="w-full h-full object-cover">
                        </div>
                    </div>
                    <div class="pt-20 pb-6 px-6 text-center">
                        <h4 class="text-xl font-bold text-dark mb-2">超屑的德华球</h4>
                        <div class="flex justify-center items-center mb-4">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                <i class="fa fa-user-circle mr-1"></i> 候选人
                            </span>
                        </div>
                        <p class="text-gray-600 mb-4">致力于为大众服务，秉持公平公正的原则参与本次选举。</p>
                        
                        <!-- 票数展示 -->
                        <div class="mb-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span>得票数:</span>
                                <span class="vote-count font-semibold" data-id="1">0</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="vote-progress bg-blue-500 h-2.5 rounded-full progress-animation" data-id="1" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <button class="vote-btn w-full py-2 px-4 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors btn-active" data-id="1">
                            <i class="fa fa-check-circle mr-1"></i> 为他投票
                        </button>
                    </div>
                </div>

                <!-- 候选人2 -->
                <div class="candidate-card bg-white rounded-xl shadow-lg overflow-hidden card-hover cursor-pointer" data-id="2">
                    <div class="h-48 bg-gradient-to-r from-green-500 to-teal-600 relative">
                        <div class="absolute -bottom-16 left-1/2 transform -translate-x-1/2 w-32 h-32 rounded-full border-4 border-white overflow-hidden">
                            <img src="https://picsum.photos/id/1025/200/200" alt="South-Vietnam的照片" class="w-full h-full object-cover">
                        </div>
                    </div>
                    <div class="pt-20 pb-6 px-6 text-center">
                        <h4 class="text-xl font-bold text-dark mb-2">South-Vietnam</h4>
                        <div class="flex justify-center items-center mb-4">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                                <i class="fa fa-user-circle mr-1"></i> 候选人
                            </span>
                        </div>
                        <p class="text-gray-600 mb-4">关注民生议题，提出多项改善社区环境的具体方案。</p>
                        
                        <!-- 票数展示 -->
                        <div class="mb-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span>得票数:</span>
                                <span class="vote-count font-semibold" data-id="2">0</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="vote-progress bg-green-500 h-2.5 rounded-full progress-animation" data-id="2" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <button class="vote-btn w-full py-2 px-4 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors btn-active" data-id="2">
                            <i class="fa fa-check-circle mr-1"></i> 为他投票
                        </button>
                    </div>
                </div>

                <!-- 候选人3 -->
                <div class="candidate-card bg-white rounded-xl shadow-lg overflow-hidden card-hover cursor-pointer" data-id="3">
                    <div class="h-48 bg-gradient-to-r from-orange-500 to-red-600 relative">
                        <div class="absolute -bottom-16 left-1/2 transform -translate-x-1/2 w-32 h-32 rounded-full border-4 border-white overflow-hidden">
                            <img src="https://picsum.photos/id/1074/200/200" alt="王·洪文的照片" class="w-full h-full object-cover">
                        </div>
                    </div>
                    <div class="pt-20 pb-6 px-6 text-center">
                        <h4 class="text-xl font-bold text-dark mb-2">王·洪文</h4>
                        <div class="flex justify-center items-center mb-4">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-orange-100 text-orange-800">
                                <i class="fa fa-user-circle mr-1"></i> 候选人
                            </span>
                        </div>
                        <p class="text-gray-600 mb-4">专注于经济发展与社会福利提升，拥有丰富的工作经验。</p>
                        
                        <!-- 票数展示 -->
                        <div class="mb-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span>得票数:</span>
                                <span class="vote-count font-semibold" data-id="3">0</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="vote-progress bg-orange-500 h-2.5 rounded-full progress-animation" data-id="3" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <button class="vote-btn w-full py-2 px-4 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors btn-active" data-id="3">
                            <i class="fa fa-check-circle mr-1"></i> 为他投票
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 投票结果区域 -->
        <section id="results" class="mb-20 bg-white p-8 rounded-2xl shadow-xl">
            <div class="text-center mb-12">
                <h3 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-dark mb-4">实时投票结果</h3>
                <p class="text-gray-600 max-w-2xl mx-auto">以下是截至目前的投票结果统计</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- 图表展示 -->
                <div>
                    <div class="bg-gray-50 p-4 rounded-xl shadow-inner">
                        <canvas id="votingChart" height="300"></canvas>
                    </div>
                </div>
                
                <!-- 详细统计 -->
                <div>
                    <div class="space-y-6">
                        <!-- 候选人1统计 -->
                        <div class="p-4 border border-gray-100 rounded-lg shadow-sm">
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-blue-500 mr-3"></div>
                                    <span class="font-semibold">超屑的德华球</span>
                                </div>
                                <span class="vote-percentage text-lg font-bold" data-id="1">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="vote-percentage-bar bg-blue-500 h-3 rounded-full progress-animation" data-id="1" style="width: 0%"></div>
                            </div>
                            <div class="mt-2 text-sm text-gray-500">
                                得票数: <span class="vote-count-detail font-medium" data-id="1">0</span>
                            </div>
                        </div>
                        
                        <!-- 候选人2统计 -->
                        <div class="p-4 border border-gray-100 rounded-lg shadow-sm">
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-green-500 mr-3"></div>
                                    <span class="font-semibold">South-Vietnam</span>
                                </div>
                                <span class="vote-percentage text-lg font-bold" data-id="2">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="vote-percentage-bar bg-green-500 h-3 rounded-full progress-animation" data-id="2" style="width: 0%"></div>
                            </div>
                            <div class="mt-2 text-sm text-gray-500">
                                得票数: <span class="vote-count-detail font-medium" data-id="2">0</span>
                            </div>
                        </div>
                        
                        <!-- 候选人3统计 -->
                        <div class="p-4 border border-gray-100 rounded-lg shadow-sm">
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-orange-500 mr-3"></div>
                                    <span class="font-semibold">王·洪文</span>
                                </div>
                                <span class="vote-percentage text-lg font-bold" data-id="3">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="vote-percentage-bar bg-orange-500 h-3 rounded-full progress-animation" data-id="3" style="width: 0%"></div>
                            </div>
                            <div class="mt-2 text-sm text-gray-500">
                                得票数: <span class="vote-count-detail font-medium" data-id="3">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 投票须知 -->
        <section class="mb-16 bg-gray-50 p-8 rounded-2xl border border-gray-100">
            <h3 class="text-2xl font-bold text-dark mb-6">投票须知</h3>
            <ul class="space-y-3">
                <li class="flex items-start">
                    <i class="fa fa-check-circle text-green-500 mt-1 mr-3"></i>
                    <span>每位用户只能投票一次，提交后不可更改，请谨慎选择。</span>
                </li>
                <li class="flex items-start">
                    <i class="fa fa-check-circle text-green-500 mt-1 mr-3"></i>
                    <span>投票过程将被记录，但会严格保护您的隐私，确保投票的匿名性。</span>
                </li>
                <li class="flex items-start">
                    <i class="fa fa-check-circle text-green-500 mt-1 mr-3"></i>
                    <span>投票截止时间为倒计时结束时，超时将无法参与投票。</span>
                </li>
                <li class="flex items-start">
                    <i class="fa fa-check-circle text-green-500 mt-1 mr-3"></i>
                    <span>如发现任何违规行为，请联系选举委员会进行举报。</span>
                </li>
            </ul>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark text-white py-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center space-x-2 mb-4">
                        <i class="fa fa-vote-yea text-primary text-2xl"></i>
                        <h3 class="text-xl font-bold">选举投票系统</h3>
                    </div>
                    <p class="text-gray-400 mb-4">提供透明、公正的选举投票平台，保障公民的民主权利。</p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors"><i class="fa fa-facebook"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors"><i class="fa fa-twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors"><i class="fa fa-instagram"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors"><i class="fa fa-youtube"></i></a>
                    </div>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">快速链接</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">首页</a></li>
                        <li><a href="#candidates" class="text-gray-400 hover:text-white transition-colors">候选人</a></li>
                        <li><a href="#results" class="text-gray-400 hover:text-white transition-colors">实时结果</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">关于选举</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">帮助中心</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">投票指南</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">常见问题</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">联系我们</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">隐私政策</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">联系我们</h4>
                    <ul class="space-y-2">
                        <li class="flex items-start">
                            <i class="fa fa-map-marker mt-1 mr-3 text-primary"></i>
                            <span class="text-gray-400">北京市朝阳区选举委员会</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fa fa-phone mr-3 text-primary"></i>
                            <span class="text-gray-400">010-12345678</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fa fa-envelope mr-3 text-primary"></i>
                            <span class="text-gray-400">election@example.com</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-500">
                <p>&copy; 2023 选举投票系统 版权所有 | 隐私政策 | 使用条款</p>
            </div>
        </div>
    </footer>

    <!-- 投票成功弹窗 -->
    <div id="voteSuccessModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 transform transition-all scale-95 opacity-0" id="modalContent">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-check text-green-500 text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-dark mb-2">投票成功！</h3>
                <p class="text-gray-600 mb-6">感谢您参与投票，您的意见对我们非常重要。</p>
                <button id="closeModal" class="px-6 py-2 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors">
                    查看结果
                </button>
            </div>
        </div>
    </div>

    <!-- 已投票提示弹窗 -->
    <div id="alreadyVotedModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 transform transition-all scale-95 opacity-0" id="alreadyVotedModalContent">
            <div class="text-center">
                <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-info text-yellow-500 text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-dark mb-2">您已投票</h3>
                <p class="text-gray-600 mb-6">每位用户只能投票一次，您可以查看实时投票结果。</p>
                <button id="closeAlreadyVotedModal" class="px-6 py-2 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors">
                    查看结果
                </button>
            </div>
        </div>
    </div>

    <!-- 返回顶部按钮 -->
    <button id="backToTop" class="fixed bottom-8 right-8 bg-primary text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center opacity-0 invisible transition-all duration-300 hover:bg-primary/90">
        <i class="fa fa-arrow-up"></i>
    </button>

    <script>
        // 确保DOM加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化投票数据
            let voteData = {
                1: 0,
                2: 0,
                3: 0
            };
            let totalVotes = 0;
            let userVoted = false;
            let userVoteId = null;
            
            // 检查并初始化本地存储
            function initLocalStorage() {
                try {
                    // 检查本地存储是否可用
                    if (typeof(Storage) === "undefined") {
                        alert("您的浏览器不支持本地存储，投票数据无法保存");
                        return;
                    }
                    
                    if (localStorage.getItem('voted') === 'true') {
                        userVoted = true;
                        userVoteId = localStorage.getItem('voteId');
                        
                        // 更新UI显示已投票状态
                        document.getElementById('voterStatus').innerHTML = '<i class="fa fa-check-circle text-green-500"></i> 已投票';
                        
                        // 从本地存储加载投票数据
                        const savedVoteData = localStorage.getItem('voteData');
                        const savedTotalVotes = localStorage.getItem('totalVotes');
                        
                        if (savedVoteData && savedTotalVotes) {
                            voteData = JSON.parse(savedVoteData);
                            totalVotes = parseInt(savedTotalVotes);
                            updateVoteDisplays();
                            disableVoteButtons();
                            highlightVotedCandidate();
                        }
                    }
                } catch (e) {
                    console.error("本地存储初始化失败:", e);
                    alert("投票数据存储出现问题，请尝试刷新页面");
                }
            }
            
            // 初始化图表
            const ctx = document.getElementById('votingChart').getContext('2d');
            const votingChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['超屑的德华球', 'South-Vietnam', '王·洪文'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: [
                            '#3b82f6', // 蓝色
                            '#22c55e', // 绿色
                            '#f97316'  // 橙色
                        ],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = totalVotes > 0 ? Math.round((value / totalVotes) * 100) : 0;
                                    return `${label}: ${value} 票 (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    }
                }
            });

            // 投票按钮点击事件 - 使用事件委托确保所有按钮都能响应
            document.addEventListener('click', function(e) {
                // 处理投票按钮点击
                if (e.target.closest('.vote-btn')) {
                    const button = e.target.closest('.vote-btn');
                    const candidateId = button.getAttribute('data-id');
                    
                    if (userVoted) {
                        showAlreadyVotedModal();
                        return;
                    }
                    
                    // 记录投票
                    voteData[candidateId]++;
                    totalVotes++;
                    userVoted = true;
                    userVoteId = candidateId;
                    
                    // 保存到本地存储
                    try {
                        localStorage.setItem('voted', 'true');
                        localStorage.setItem('voteId', candidateId);
                        localStorage.setItem('voteData', JSON.stringify(voteData));
                        localStorage.setItem('totalVotes', totalVotes.toString());
                    } catch (e) {
                        console.error("保存投票数据失败:", e);
                        alert("保存投票数据失败，请尝试刷新页面");
                    }
                    
                    // 更新UI
                    updateVoteDisplays();
                    disableVoteButtons();
                    highlightVotedCandidate();
                    document.getElementById('voterStatus').innerHTML = '<i class="fa fa-check-circle text-green-500"></i> 已投票';
                    
                    // 显示成功弹窗
                    showVoteSuccessModal();
                }
                
                // 处理候选人卡片点击
                else if (e.target.closest('.candidate-card') && !e.target.closest('.vote-btn')) {
                    const card = e.target.closest('.candidate-card');
                    const candidateId = card.getAttribute('data-id');
                    
                    if (userVoted) {
                        showAlreadyVotedModal();
                        return;
                    }
                    
                    // 触发对应按钮的点击事件
                    document.querySelector(`.vote-btn[data-id="${candidateId}"]`).click();
                }
            });

            // 更新所有投票显示
            function updateVoteDisplays() {
                // 更新票数显示
                for (const id in voteData) {
                    const percentage = totalVotes > 0 ? Math.round((voteData[id] / totalVotes) * 100) : 0;
                    
                    // 更新候选人卡片中的票数和进度条
                    document.querySelector(`.vote-count[data-id="${id}"]`).textContent = voteData[id];
                    document.querySelector(`.vote-progress[data-id="${id}"]`).style.width = `${percentage}%`;
                    
                    // 更新结果区域的显示
                    document.querySelector(`.vote-percentage[data-id="${id}"]`).textContent = `${percentage}%`;
                    document.querySelector(`.vote-percentage-bar[data-id="${id}"]`).style.width = `${percentage}%`;
                    document.querySelector(`.vote-count-detail[data-id="${id}"]`).textContent = voteData[id];
                }
                
                // 更新总票数
                document.getElementById('totalVotes').textContent = totalVotes;
                
                // 更新图表
                votingChart.data.datasets[0].data = [voteData[1], voteData[2], voteData[3]];
                votingChart.update();
            }

            // 禁用所有投票按钮
            function disableVoteButtons() {
                document.querySelectorAll('.vote-btn').forEach(button => {
                    button.disabled = true;
                    button.classList.remove('bg-primary', 'hover:bg-primary/90', 'btn-active');
                    button.classList.add('bg-gray-300', 'cursor-not-allowed');
                });
            }

            // 高亮显示用户已投票的候选人
            function highlightVotedCandidate() {
                if (userVoteId) {
                    const votedCard = document.querySelector(`.candidate-card[data-id="${userVoteId}"]`);
                    votedCard.classList.add('voted');
                    
                    // 修改已投票候选人的按钮文本
                    const votedButton = document.querySelector(`.vote-btn[data-id="${userVoteId}"]`);
                    votedButton.innerHTML = '<i class="fa fa-check-circle mr-1"></i> 已投票';
                    votedButton.classList.add('bg-green-500');
                }
            }

            // 显示投票成功弹窗
            function showVoteSuccessModal() {
                const modal = document.getElementById('voteSuccessModal');
                const modalContent = document.getElementById('modalContent');
                
                modal.classList.remove('hidden');
                // 触发动画
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            }

            // 显示已投票提示弹窗
            function showAlreadyVotedModal() {
                const modal = document.getElementById('alreadyVotedModal');
                const modalContent = document.getElementById('alreadyVotedModalContent');
                
                modal.classList.remove('hidden');
                // 触发动画
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            }

            // 关闭投票成功弹窗
            document.getElementById('closeModal').addEventListener('click', () => {
                const modal = document.getElementById('voteSuccessModal');
                const modalContent = document.getElementById('modalContent');
                
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                    // 滚动到结果区域
                    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                }, 300);
            });

            // 关闭已投票提示弹窗
            document.getElementById('closeAlreadyVotedModal').addEventListener('click', () => {
                const modal = document.getElementById('alreadyVotedModal');
                const modalContent = document.getElementById('alreadyVotedModalContent');
                
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                    // 滚动到结果区域
                    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                }, 300);
            });

            // 移动端菜单切换
            const menuToggle = document.getElementById('menuToggle');
            const mobileMenu = document.getElementById('mobileMenu');
            
            menuToggle.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            // 导航栏滚动效果
            const navbar = document.getElementById('navbar');
            
            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    navbar.classList.add('py-2', 'shadow-lg');
                    navbar.classList.remove('py-3', 'shadow-md');
                } else {
                    navbar.classList.add('py-3', 'shadow-md');
                    navbar.classList.remove('py-2', 'shadow-lg');
                }
            });

            // 返回顶部按钮
            const backToTopButton = document.getElementById('backToTop');
            
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    backToTopButton.classList.remove('opacity-0', 'invisible');
                    backToTopButton.classList.add('opacity-100', 'visible');
                } else {
                    backToTopButton.classList.add('opacity-0', 'invisible');
                    backToTopButton.classList.remove('opacity-100', 'visible');
                }
            });
            
            backToTopButton.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });

            // 平滑滚动
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    
                    const targetId = this.getAttribute('href');
                    if (targetId === '#') return;
                    
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth'
                        });
                        
                        // 关闭移动菜单（如果打开）
                        if (!mobileMenu.classList.contains('hidden')) {
                            mobileMenu.classList.add('hidden');
                        }
                    }
                });
            });

            // 倒计时功能
            function updateCountdown() {
                // 设置截止日期（示例：当前时间加7天）
                const now = new Date();
                const endDate = new Date(now);
                endDate.setDate(now.getDate() + 7);
                endDate.setHours(12, 30, 0, 0);
                
                // 计算剩余时间
                const diff = endDate - now;
                
                if (diff <= 0) {
                    document.getElementById('countdown').textContent = '已结束';
                    return;
                }
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                document.getElementById('countdown').textContent = `${days}天${hours}小时${minutes}分钟`;
            }
            
            // 初始化
            initLocalStorage();
            updateCountdown();
            setInterval(updateCountdown, 60000); // 每分钟更新一次
        });
    </script>
</body>
</html>
